<!doctype html>
<html>
<head>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <meta charset="utf-8">
    <title>Demo</title>
    <link rel="stylesheet" type="text/css" href="style/css/reset.css"/>
    <link rel="stylesheet" type="text/css" href="style/css/main.css"/>
    <link rel="stylesheet" type="text/css" href="style/css/transition.min.css"/>

    <link rel="stylesheet" type="text/css" href="http://at.alicdn.com/t/font_1420300224_9331315.css"/>

    <script type="text/javascript" src="style/js/zepto.js"></script>
    <script type="text/javascript" src="style/js/AV.push.js"></script>
    <script type="text/javascript" src="style/js/transition.min.js"></script>
    <script type="text/javascript" src="style/js/biz.js"></script>
</head>
<body class="page-signup">
    <div id="page-username" data-role="page">
        <div class="content-wrap">
            <div class="content-inner">
                <input type="text" id="username" data-validator-element="checkUserName" placeholder="用户名" value="kitty"/>
                <a data-validator="checkUserName" transition="slide" class="next-button" href="#page-mobile">Next</a>
            </div>
        </div>
    </div>
    <div id="page-avatar" data-role="page" data-title="用户头像">
        <div class="content-wrap">
            <div class="content-inner">
                <input type="file" id="avatar" placeholder="头像"/>
                <a data-validator="avatar" transition="slide" class="next-button" href="#page-mobile">Next</a>
            </div>
        </div>
    </div>
    <div id="page-mobile" data-role="page" data-title="手机号">
        <div class="content-wrap">
            <div class="content-inner">
                <input type="text" value="18058167549" id="phone" data-validator-element="sendVerifyCode" placeholder="手机号"/>
                <input type="password" value="123456" id="password" placeholder="密码"/>
                <a data-validator="sendVerifyCode" transition="slide" class="next-button" href="#page-verification">Next</a>
            </div>
        </div>
    </div>
    <div id="page-verification" data-role="page" data-title="手机验证">
        <div class="content-wrap">
            <div class="content-inner">
                <input type="text" value="883769" id="code" data-validator-element="handleVerifyCode" placeholder="验证码"/>
                <a data-validator="handleVerifyCode" transition="slide" class="next-button" href="#page-signup-successful">Next</a>
            </div>
        </div>
    </div>
    <div id="page-signup-successful" data-role="page" data-title="注册成功">
        <div class="content-wrap">
            <div class="content-inner">
                <h1>Successful!</h1>
                <button class="next-button">Next</button>
            </div>
        </div>
    </div>
    <script>
        function signup( callback ){
            momentBiz.ajax({
                data : {
                    "phone": $('#phone').val(),
                    "username": $('#username').val(),
                    "password": $('#password').val()
                },
                functions : 'regesterOnline',
                success : function( remoteData ){
                    if( remoteData && remoteData.result.code === 200 && remoteData.result.results ){
                        callback(true);
                    }else{
                        callback(false);
                    }
                },
                error: function(xhr, type){
                    callback(false);
                }
            });
        }

        $('[data-role="page"] [data-validator]').on('click',function( e ){
            var elm = $(e.target),
                type = elm.data('validator'),
                ipt = $('[data-validator-element="'+type+'"]'),
                data = {};

            data[ipt.prop('id')] = ipt.val();
            momentBiz.ajax({
                data : data,
                functions : type,
                success : function( remoteData ){
                    //console.log( elm.attr('href') );
                    if( remoteData && remoteData.result.code === 200 && remoteData.result.results ){
                        var href = elm.attr('href');
                        if( href.indexOf('#') === 0 ){
                            if( href === '#page-signup-successful'){
                                signup(function(boo){
                                    if( boo ){
                                        location.hash = href;
                                    }
                                });
                            }else{
                                location.hash = href;
                            }
                        }else{
                            location.href = href;
                        }
                    }
                },
                error: function(xhr, type){
                }
            });

            e.stopPropagation();
            return false;
        });
        $('#page-signup-successful button').on('click',function(e){
            location.href = 'index.html';
        });
    </script>
</body>
</html>